<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NiYien A1 视频教程</title>
  <link rel="icon" href="assets/icon/logo.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            accent: '#722ED1',
            neutral: '#F2F3F5',
            'neutral-dark': '#4E5969',
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }

      .video-ratio {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 比例 */
        height: 0;
        overflow: hidden;
      }

      .video-ratio iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* 阻止iframe的点击事件 */
      }

      /* 模态框中的视频允许点击 */
      .modal .video-ratio iframe {
        pointer-events: auto;
      }

      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:scale-[1.02] hover:z-10;
      }

      .section-title {
        @apply text-xl font-bold text-gray-800 mb-3 flex items-center cursor-pointer;
      }

      .required-badge {
        @apply bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full ml-2;
      }

      .filter-active {
        @apply bg-primary text-white;
      }

      .first-use-badge {
        @apply bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full;
        transform: scale(0.8);
        transform-origin: center;
      }

      /* 统一视频卡片宽度 - 修改为响应式 */
      .video-card {
        @apply w-full max-w-md mx-auto; /* 最大宽度为md，在小屏幕上自动适应 */
      }

      .video-grid-container {
        @apply max-w-7xl mx-auto px-4; /* 增加内边距防止边缘溢出 */
      }

      /* 响应式字体调整 */
      .header-title {
        @apply text-2xl md:text-[clamp(1.5rem,3vw,2rem)] font-bold text-gray-800;
      }

      .nav-button {
        @apply text-sm md:text-base px-4 md:px-6 py-2 md:py-3;
      }

      /* 调整下载卡片 */
      .download-card {
        @apply bg-white rounded-xl shadow-sm p-6 text-center transition-all duration-300 hover:shadow-lg hover:scale-[1.02];
      }

      .wechat-qrcode {
        @apply bg-white rounded-xl shadow-sm p-6 text-center transition-all duration-300 hover:shadow-lg;
      }

      /* 折叠面板样式 */
      .collapsible-header {
        @apply flex justify-between items-center py-4 px-6 cursor-pointer bg-white border-b border-gray-100 hover:bg-gray-50 transition-colors;
      }

      .collapsible-content {
        @apply max-h-0 overflow-hidden transition-all duration-300 ease-in-out;
      }

      .collapsible-content-expanded {
        @apply max-h-[1000px];
      }

      .collapsible-icon {
        @apply transition-transform duration-300;
      }

      .collapsible-icon-expanded {
        @apply rotate-180;
      }

      /* 软件下载区域样式调整 */
      .download-icon {
        @apply text-6xl text-gray-600; /* 增大图标尺寸 */
      }

      .download-title {
        @apply text-lg font-semibold text-gray-800 mb-1; /* 减小标题字体 */
      }

      .download-desc {
        @apply text-sm text-gray-600 mb-3; /* 减小描述字体 */
      }

      .download-button {
        @apply bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center justify-center mx-auto text-sm; /* 减小按钮尺寸和字体 */
      }

      /* 模态框样式 */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.7);
      }

      .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 1200px;
        position: relative;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }

      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

      /* 下载确认弹窗样式 */
      .download-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
      }

      .download-modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        text-align: center;
        border-radius: 10px;
      }

      .download-modal-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
      }

      /* 紧凑模式样式 */
      .compact-section {
        @apply mt-2;
      }

      .compact-card {
        @apply p-4 shadow-none;
      }

      .compact-icon {
        @apply text-4xl;
      }

      .compact-title {
        @apply text-lg font-bold; /* 加大文字 */
      }

      .compact-desc {
        @apply text-xs mb-2;
      }

      .compact-button {
        @apply px-4 py-2 text-sm bg-primary hover:bg-primary/90 text-white rounded-lg transition-all duration-300; /* 加大按钮 */
      }

      /* 下载卡片样式 */
      .download-card {
        @apply p-4 shadow-md rounded-lg border border-gray-200 min-h-[180px]; /* 恢复原始内边距，移除最小高度 */
      }
    }
  </style>
</head>

<body class="font-inter bg-gray-50 min-h-screen flex flex-col">
  <!-- 顶部导航栏 -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row md:items-center md:justify-between gap-2">
      <div class="flex items-center min-w-0">
        <i class="fas fa-video text-primary text-3xl mr-3"></i>
        <h1 class="header-title truncate">NiYien A1 视频教程</h1>
      </div>
      <div class="flex flex-nowrap items-center justify-end min-w-0 gap-2 overflow-x-auto">
        <!-- 调整按钮顺序，将首次使用按钮放在左边 -->
        <button id="firstUseBtn" class="flex-shrink-0 bg-secondary hover:bg-secondary/90 text-white text-xs sm:text-sm px-3 sm:px-4 py-1 sm:py-2 rounded-lg transition-all duration-300 flex items-center">
          <i class="fa fa-rocket mr-1 sm:mr-2"></i> 首次使用
        </button>
        <!-- 将首次使用模式字样移动到图文教程按钮左边 -->
        <span id="firstUseBadge" class="flex-shrink-0 hidden first-use-badge text-xs sm:text-sm px-3 sm:px-4 py-1 sm:py-2 rounded-lg transition-all duration-300 flex items-center"">首次使用</span>
        <button id="textTutorialBtn" class="flex-shrink-0 bg-accent hover:bg-accent/90 text-white text-xs sm:text-sm px-3 sm:px-4 py-1 sm:py-2 rounded-lg transition-all duration-300 flex items-center">
          <i class="fa fa-book mr-1 sm:mr-2"></i> 图文教程
        </button>
        <button id="showAllBtn" class="flex-shrink-0 bg-primary hover:bg-primary/90 text-white text-xs sm:text-sm px-3 sm:px-4 py-1 sm:py-2 rounded-lg transition-all duration-300 flex items-center hidden">
          <i class="fa fa-th-large mr-1 sm:mr-2"></i> 展示全部
        </button>
        <!-- 添加语言切换按钮 -->
        <a id="englishManualLink" href="#" class="flex-shrink-0 bg-gray-800 hover:bg-gray-700 text-white text-xs sm:text-sm px-3 sm:px-4 py-1 sm:py-2 rounded-lg transition-all duration-300 flex items-center">
          <i class="fa fa-language mr-1 sm:mr-2"></i> English
        </a>
      </div>
    </div>
  </header>

  <!-- 软件下载与更新日志区域 -->
  <section class="bg-white border-b border-gray-100 mt-4 compact-section">
    <div class="container mx-auto px-4">
      <div id="softwareDownloadHeader" class="collapsible-header">
        <div class="flex items-center">
          <i class="fa fa-download text-primary text-xl mr-3"></i>
          <h2 class="text-xl font-bold text-gray-800">软件下载与更新日志</h2>
        </div>
        <i id="softwareDownloadIcon" class="fa fa-chevron-down text-gray-500 collapsible-icon"></i>
      </div>
      <div id="softwareDownloadContent" class="collapsible-content">
        <div class="py-4 flex justify-center">
          <div class="flex flex-col md:flex-row gap-8 w-full max-w-5xl items-center">
            <div class="w-full">
              <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-6 mb-6">
                <!-- Mac软件下载 -->
                <div class="download-card flex flex-col items-center h-full p-4">
                  <div class="flex items-center mb-3 justify-center w-full">
                    <i class="fab fa-apple text-gray-600 text-4xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800 whitespace-nowrap">NiYien A1 for Mac</h3>
                  </div>
                  <p class="version-text text-sm text-gray-500 text-center w-full"></p> <!-- 版本号居中 -->
                  <p class="download-desc compact-desc text-center w-full">兼容 macOS11 及以上版本</p> <!-- 兼容提示居中 -->
                  <button class="download-button compact-button w-full md:w-auto" onclick="showDownloadModal(config.urls.downloadMac)">
                    <i class="fa fa-download mr-2"></i> 下载
                  </button>
                </div>

                <!-- Windows软件下载 -->
                <div class="download-card flex flex-col items-center h-full p-4">
                  <div class="flex items-center mb-3 justify-center w-full">
                    <i class="fab fa-windows text-gray-600 text-4xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800 whitespace-nowrap">NiYien A1 for Win</h3>
                  </div>
                  <p class="version-text text-sm text-gray-500 text-center w-full"></p> <!-- 版本号居中 -->
                  <p class="download-desc compact-desc text-center w-full">兼容 Win10 及以上版本</p> <!-- 兼容提示居中 -->
                  <button class="download-button compact-button w-full md:w-auto" onclick="showDownloadModal(config.urls.downloadWindows)">
                    <i class="fa fa-download mr-2"></i> 下载
                  </button>
                </div>

                
                <!-- 更新日志卡片 -->
                <div class="download-card flex flex-col items-center h-full p-4">
                  <div class="flex items-center mb-3 justify-center w-full">
                    <i class="fa fa-history text-gray-600 text-4xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800 whitespace-nowrap">更新日志</h3>
                  </div>
                  <div class="space-y-2 text-xs">
                    <button class="download-button compact-button w-full" onclick="window.open(config.urls.firmwareChangelog, '_blank')">
                    <i class="fa fa-microchip mr-2"></i> 设备固件日志
                    </button>
                    <button class="download-button compact-button w-full" onclick="window.open(config.urls.softwareChangelog, '_blank')">
                    <i class="fa fa-wrench mr-2"></i> 尼影工具日志
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 加入交流群区域（恢复折叠面板样式） -->
  <section class="bg-white border-b border-gray-100 mt-4 compact-section">
    <div class="container mx-auto px-4">
      <div id="wechatGroupHeader" class="collapsible-header">
        <div class="flex items-center">
          <i class="fa fa-comments text-primary text-xl mr-3"></i>
          <h2 class="text-xl font-bold text-gray-800">加入交流群</h2>
        </div>
        <i id="wechatGroupIcon" class="fa fa-chevron-down text-gray-500 collapsible-icon"></i>
      </div>
      <div id="wechatGroupContent" class="collapsible-content">
        <div class="py-6 flex justify-center">
          <div class="wechat-qrcode">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">扫描二维码, 邀请您进微信群</h3>
            <div class="w-80 h-80 mx-auto bg-white p-4 rounded shadow-md">
              <img id="wechatQrCodeImg" src="" alt="微信群二维码" class="w-full h-full object-contain">
            </div>
            <p class="text-gray-600 text-sm mt-4">与其他用户交流使用经验，获取最新用法</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // 集中管理所有URL和图片路径，方便后续修改
    const config = {
      urls: {
        textTutorial: "NiYien_txt_manual_ZH.html",
        firmwareChangelog: "https://www.niyien.com/update_A1_zh.html",
        softwareChangelog: "https://www.niyien.com/update_Niyien_tool_zh.html",
        downloadMac: "https://vip.123pan.cn/1846941948/NiYien%E8%BD%AF%E4%BB%B6/niyien_for_macos.zip",
        downloadWindows: "https://vip.123pan.cn/1846941948/NiYien%E8%BD%AF%E4%BB%B6/niyien_for_windows.zip",
        englishManual: "NiYien_manual_EN.html" // 添加英文手册URL
      },
      images: {
        wechatQrCode: "assets/qrcode/VX.png"
      }
    };

    // 视频数据
    const videoData = [
      {
        id: "1.1",
        title: "简介",
        description: "了解产品的功能和特色",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860797070572&bvid=BV1Aruxz9Eqi&cid=31070749208&p=1&autoplay=0 scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" ></iframe>',
        isRequired: false,
        category: "software",
        showConditions: ""
      },
      {
        id: "1.2",
        title: "软件下载与安装",
        description: "详细介绍软件下载和安装过程",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860813844613&bvid=BV1w2uxznEWj&cid=31070818075&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: true,
        category: "software",
        showConditions: ""
      },
      {
        id: "2.1",
        title: "陀螺仪按键操作",
        description: "陀螺仪的按键功能和操作方法",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860914378117&bvid=BV16Kuxz2EXG&cid=31071732436&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: true,
        category: "gyroscope",
        showConditions: ""
      },
      {
        id: "2.2",
        title: "固件升级、时间设置、格式化存储卡、水平校准",
        description: "了解陀螺仪的各项设置",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860914380241&bvid=BV16Kuxz2E54&cid=31071734750&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: false,
        category: "gyroscope",
        showConditions: ""
      },
      {
        id: "3.1",
        title: "自动模式",
        description: "掌握自动模式的使用方法",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860931219509&bvid=BV1wNuxzEEnh&cid=31071798626&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: true,
        category: "tools",
        showConditions: ""
      },
      {
        id: "3.2",
        title: "半自动与手动模式",
        description: "掌握半自动和手动模式的使用方法",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860931222737&bvid=BV1cNuxzEEHq&cid=31071863199&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: true,
        category: "tools",
        showConditions: ""
      },
      {
        id: "3.3",
        title: "输出设置(安装方向、锁定地平线、同步速度、高级选项)",
        description: "详细了解各项输出设置的功能和应用场景",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860931156190&bvid=BV1rNuxz7E3L&cid=31071866745&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: false,
        category: "tools",
        showConditions: ""
      },
      {
        id: "4.1",
        title: "视频编辑器插件",
        description: "学习如何在主流视频编辑器中使用插件",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860947933789&bvid=BV1zuuxzyEVn&cid=31071930528&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: false,
        category: "advanced",
        showConditions: "editor"
      },
      {
        id: "4.2",
        title: "竖拍",
        description: "了解竖拍视频的增稳",
        date: "2025-09-24",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=115263986993823&bvid=BV1dhn4zBEAp&cid=32622315213&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: false,
        category: "advanced",
        showConditions: ""
      },
      {
        id: "4.3",
        title: "变宽",
        description: "了解电影宽荧幕镜头增稳",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860948062369&bvid=BV1Juuxz1EBb&cid=31071995688&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: false,
        category: "advanced",
        showConditions: ""
      },
      {
        id: "4.4",
        title: "升格",
        description: "了解升格拍摄的增稳",
        date: "2025-07-15",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=114860947933910&bvid=BV1zuuxzyE3L&cid=31072059544&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: false,
        category: "advanced",
        showConditions: ""
      },
      {
        id: "4.5",
        title: "RAW,Log,10-bit,12-bit视频",
        description: "了解特殊视频格式的增稳",
        date: "2025-09-25",
        embedCode: '<iframe src="https://player.bilibili.com/player.html?isOutside=true&aid=115262091166938&bvid=BV1KMn4zsEoX&cid=32612747010&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        isRequired: false,
        category: "advanced",
        showConditions: ""
      }
    ];
  </script>

  <main class="flex-grow px-6 py-8">
    <!-- 教程章节区域 -->
    <section id="tutorialsContainer" class="space-y-8">
      <!-- 视频内容将通过JavaScript动态渲染 -->
    </section>
  </main>

  <footer class="bg-gray-800 text-white py-8 mt-12">
    <div class="container mx-auto px-4">
      <div class="flex flex-col items-center">
        <div class="flex items-center mb-4">
          <i class="fa fa-video-camera text-primary text-2xl mr-3"></i>
          <h2 class="text-xl font-bold">NiYien A1 视频教程</h2>
        </div>
      </div>
    </div>
  </footer>

  <!-- 模态框 -->
  <div id="videoModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="modalVideo" class="video-ratio"></div>
    </div>
  </div>

  <!-- 下载确认弹窗 -->
  <div id="downloadModal" class="download-modal">
    <div class="download-modal-content">
      <h3 class="text-lg font-bold mb-2">确认下载</h3>
      <p class="text-gray-600 mb-4">您确定要下载 NiYien A1 软件吗？</p>
      <div class="download-modal-buttons">
        <button id="downloadCancelBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition-all duration-300">
          取消
        </button>
        <button id="downloadConfirmBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-300">
          确定
        </button>
      </div>
    </div>
  </div>

  <script>
    // 折叠面板交互
    function setupCollapsible(headerId, contentId, iconId) {
      const header = document.getElementById(headerId);
      const content = document.getElementById(contentId);
      const icon = document.getElementById(iconId);

      header.addEventListener('click', () => {
        content.classList.toggle('collapsible-content-expanded');
        icon.classList.toggle('collapsible-icon-expanded');
      });
    }

    // 设置所有折叠面板
    // 初始化所有折叠面板
    setupCollapsible('softwareDownloadHeader', 'softwareDownloadContent', 'softwareDownloadIcon');
    // 添加交流群折叠面板初始化
    setupCollapsible('wechatGroupHeader', 'wechatGroupContent', 'wechatGroupIcon');
    
    // 修复二维码图片显示问题
    document.addEventListener('DOMContentLoaded', function() {
	  const englishManualLink = document.getElementById('englishManualLink');
      if (englishManualLink) {
        englishManualLink.href = config.urls.englishManual;
      }
      // 添加首次使用状态缓存逻辑
      let firstUseMode = localStorage.getItem('firstUseMode');
      
      // 默认情况下启用首次使用模式
      if (firstUseMode === null) {
        firstUseMode = 'true';  // 设置默认值为true
        localStorage.setItem('firstUseMode', firstUseMode);
      }
      
      // 根据保存的状态显示对应模式
      if (firstUseMode === 'true') {
        // 首次使用模式
        firstUseBadge.classList.remove('hidden');
        firstUseBtn.classList.add('hidden');
        showAllBtn.classList.remove('hidden');
        const filteredVideos = videoData.filter(video => video.isRequired);
        renderVideos(filteredVideos);
      } else {
        // 显示全部模式
        firstUseBadge.classList.add('hidden');
        showAllBtn.classList.add('hidden');
        firstUseBtn.classList.remove('hidden');
        renderVideos(videoData);
      }
      const qrCodeImg = document.getElementById('wechatQrCodeImg');
      if (qrCodeImg) {
        qrCodeImg.src = config.images.wechatQrCode;
        // 添加错误处理，二维码加载失败时显示备用文本
        qrCodeImg.onerror = function() {
          this.alt = '微信群二维码（图片加载失败）';
          this.style.backgroundColor = '#f0f0f0';
          this.style.display = 'flex';
          this.style.alignItems = 'center';
          this.style.justifyContent = 'center';
          this.innerHTML = '<i class="fa fa-qrcode text-5xl text-gray-400"></i>';
        };
      }

      // 动态加载版本号
      fetch('Update/update.json')
        .then(response => {
          if (!response.ok) throw new Error('Network response was not ok');
          return response.json();
        })
        .then(data => {
          const version = data.NiYien_tool.version;
          // 更新版本号显示
          document.querySelectorAll('.version-text').forEach(el => {
            el.textContent = `版本: ${version}`;
          });
        })
        .catch(error => console.error('Error loading version:', error));
    });

    // 章节折叠/展开功能
    document.querySelectorAll('.section-title').forEach(title => {
      title.addEventListener('click', () => {
        const sectionId = title.getAttribute('data-section');
        const content = document.getElementById(sectionId);
        const icon = title.querySelector('i.fa-chevron-down');

        content.classList.toggle('hidden');
        icon.classList.toggle('rotate-180');
      });
    });

    // 初始状态下所有章节都是展开的
    document.querySelectorAll('.section-title').forEach(title => {
      const icon = title.querySelector('i.fa-chevron-down');
      icon.classList.add('rotate-180');
    });

    // 渲染视频卡片
    function renderVideos(videos) {
      const container = document.getElementById('tutorialsContainer');
      container.innerHTML = '';

      // 按类别分组视频
      const categories = {};
      videos.forEach(video => {
        if (!categories[video.category]) {
          categories[video.category] = [];
        }
        categories[video.category].push(video);
      });

      // 渲染每个类别
      for (const category in categories) {
        const categoryVideos = categories[category];

        // 创建章节容器
        const section = document.createElement('div');
        section.className = 'bg-white rounded-xl shadow-sm overflow-hidden';

        // 创建章节标题
        const titleBar = document.createElement('div');
        titleBar.className = 'p-6 border-b border-gray-100 section-title';
        titleBar.setAttribute('data-section', category);

        // 设置图标和标题文本
        let iconClass = 'fa-laptop';
        let sectionTitle = '';

        switch (category) {
          case 'software':
            iconClass = 'fa-laptop';
            sectionTitle = '1. 软件';
            break;
          case 'gyroscope':
            iconClass = 'fa-compass';
            sectionTitle = '2. 陀螺仪操作';
            break;
          case 'tools':
            iconClass = 'fa-wrench';
            sectionTitle = '3. 尼影工具操作';
            break;
          case 'advanced':
            iconClass = 'fa-rocket';
            sectionTitle = '4. 进阶应用';
            break;
        }

        titleBar.innerHTML = `
          <i class="fa ${iconClass} text-primary mr-3"></i>
          <span>${sectionTitle}</span>
          <i class="fa fa-chevron-down ml-auto transition-transform duration-300"></i>
        `;

        // 创建视频内容容器
        const content = document.createElement('div');
        content.className = 'p-6 space-y-6';
        content.id = category;

        // 创建视频网格（响应式布局调整）
        const videoGrid = document.createElement('div');
        videoGrid.className = 'video-grid-container grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';

        // 添加视频卡片
        categoryVideos.forEach(video => {
            const card = document.createElement('div');
            // 使用新的video-card类统一宽度
            card.className = 'rounded-lg overflow-hidden shadow-sm card-hover video-card';
            card.setAttribute('data-id', video.id);
            if (video.showConditions) {
              card.setAttribute('data-show', video.showConditions);
            }

            // 检查是否需要显示"二选一"标记
            let badgeHtml = '';
            if (video.isRequired) {
              const bothVisible = videos.some(v => v.id === "3.1" && v.isRequired) &&
                videos.some(v => v.id === "3.2" && v.isRequired);

              if (bothVisible && (video.id === "3.1" || video.id === "3.2")) {
                badgeHtml = '<span class="required-badge">二选一</span>';
              } else {
                badgeHtml = '<span class="required-badge">必看</span>';
              }
            }

            card.innerHTML = `
                <div class="relative video-ratio bg-gray-200">
                    <img src="assets/tn/zh/${video.id.replace('.', '_')}.jpg" alt="${video.title}" class="absolute inset-0 w-full h-full object-cover">
                    <span class="absolute top-2 left-2 bg-primary text-white text-xs font-bold px-2 py-1 rounded">${video.id}</span>
                </div>
                <div class="p-4">
                    <h3 class="font-semibold text-gray-800 mb-2">${video.title}</h3>
                    <p class="text-gray-600 text-sm mb-3">${video.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-500 text-xs"><i class="fa fa-calendar mr-1"></i> ${video.date}</span>
                        ${badgeHtml}
                    </div>
                </div>
            `;

            // 添加视频卡片点击事件
            card.addEventListener('click', () => {
              openVideoModal(video.embedCode);
            });

            videoGrid.appendChild(card);
          });

          content.appendChild(videoGrid);
          section.appendChild(titleBar);
          section.appendChild(content);
          container.appendChild(section);
        }

        // 绑定章节折叠事件
        document.querySelectorAll('.section-title').forEach(title => {
          title.addEventListener('click', () => {
            const sectionId = title.getAttribute('data-section');
            const content = document.getElementById(sectionId);
            const icon = title.querySelector('i.fa-chevron-down');

            content.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
          });
        });
    }

    const firstUseBtn = document.getElementById('firstUseBtn');
    const showAllBtn = document.getElementById('showAllBtn');
    const firstUseBadge = document.getElementById('firstUseBadge');
    const textTutorialBtn = document.getElementById('textTutorialBtn');

    // 图文教程按钮点击事件
    textTutorialBtn.addEventListener('click', () => {
    // 在新窗口打开图文教程页面
    window.open(config.urls.textTutorial, '_blank');
    });

    // 首次使用按钮点击事件
    firstUseBtn.addEventListener('click', () => {
      // 切换到首次使用模式
      firstUseBadge.classList.remove('hidden');
      firstUseBtn.classList.add('hidden');
      showAllBtn.classList.remove('hidden');

      // 过滤显示必要的视频
      const filteredVideos = videoData.filter(video => video.isRequired);
      renderVideos(filteredVideos);
      
      // 更新缓存状态 - 设置为首次使用模式
      localStorage.setItem('firstUseMode', 'true');
    });

    // 显示全部按钮点击事件
    showAllBtn.addEventListener('click', () => {
      // 切换回显示全部模式
      firstUseBadge.classList.add('hidden');
      showAllBtn.classList.add('hidden');
      firstUseBtn.classList.remove('hidden');

      // 显示所有视频
      renderVideos(videoData);
      
      // 更新缓存状态 - 设置为显示全部模式
      localStorage.setItem('firstUseMode', 'false');
    });

    // 打开视频模态框
    function openVideoModal(embedCode) {
      const modal = document.getElementById('videoModal');
      const modalVideo = document.getElementById('modalVideo');
      const closeBtn = document.getElementsByClassName('close')[0];

      // 设置视频内容
      modalVideo.innerHTML = embedCode;

      // 显示模态框
      modal.style.display = 'block';

      // 关闭按钮事件
      closeBtn.onclick = function() {
        modal.style.display = 'none';
        // 清空视频内容以停止播放
        modalVideo.innerHTML = '';
      }

      // 点击模态框外部关闭
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = 'none';
          // 清空视频内容以停止播放
          modalVideo.innerHTML = '';
        }
      }
    }

    // 显示下载确认弹窗
    function showDownloadModal(url) {
      const modal = document.getElementById('downloadModal');
      const confirmBtn = document.getElementById('downloadConfirmBtn');
      const cancelBtn = document.getElementById('downloadCancelBtn');

      // 显示模态框
      modal.style.display = 'block';

      // 确认下载
      confirmBtn.onclick = function() {
        modal.style.display = 'none';
        // 跳转到下载链接
        window.location.href = url;
      }

      // 取消下载
      cancelBtn.onclick = function() {
        modal.style.display = 'none';
      }

      // 点击模态框外部关闭
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = 'none';
        }
      }
    }

    // 初始渲染所有视频
    renderVideos(videoData);
  </script>
</body>

</html>
